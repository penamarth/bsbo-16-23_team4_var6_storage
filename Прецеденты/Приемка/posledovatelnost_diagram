@startuml
actor Оператор

Оператор -> StorageHouse :  startAcceptance(id, manager, date)
activate StorageHouse


StorageHouse -> ExternalSystem : getExternalData(id, manager, date)
activate ExternalSystem
ExternalSystem -> StorageHouse : all_items_data
deactivate ExternalSystem

StorageHouse -> Acceptance : startProcess(all_items_data)
Acceptance -> Batch : createBatch(items_data)
loop для каждого Item
Batch -> Item : craeteItem()
Item -> Batch : item
end
Batch -> Acceptance : items


loop для каждого Item
    Acceptance -> iStorage : getEmpty(item)
    activate iStorage
    iStorage -> StorageComposit : GetEmpty(Item)
    activate StorageComposit
    StorageComposit -> StockHouse : GetEmpty(Item)
    activate StockHouse
    StockHouse -> StockRoom : GetEmpty(Item)
    activate StockRoom
    StockRoom -> StockRack : GetEmpty(Item)
    activate StockRack
    StockRack -> StockCell : CanStore(Item)
    activate StockCell
    StockCell --> StockRack : true/false
    deactivate StockCell
    StockRack --> StockRoom : cellAddress
    deactivate StockRack
    StockRoom --> StockHouse: rackAddress
    deactivate StockRoom
    StockHouse -> StorageComposit : roomAddress
    StorageComposit --> Acceptance : address
    deactivate StockHouse
    deactivate StorageComposit
    deactivate iStorage

    Acceptance -> storRepos : savePlacement(item, address)
    storRepos -> Acceptance : placement_id
end

Acceptance -> DocWorks : createDocument(acceptance_data)
DocWorks -> AcceptanceDoc : createAcceptance(items, storage_adresses)
AcceptanceDoc -> DocWorks : document
DocWorks -> docRepos : saveDocument(document)
docRepos -> DocWorks : document_id

DocWorks -> Acceptance : document_id
Acceptance -> StorageHouse : (items, adresses, documents_id)

StorageHouse -> Оператор : информация о завершении
@enduml
